<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <title>InfoMagic – Admin</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="admin-page">
    <button class="logout-btn" onclick="logout()">Logga ut</button>

    <div class="admin-container">
      <h1>Admin</h1>

      <h2>Bildkvalitet</h2>
      <input id="min" type="number" />
      <button onclick="saveCfg()">Spara</button>

      <h2>Kalender</h2>
      <label>Kalender-ID:</label>
      <input
        id="calendarId"
        type="text"
        placeholder="example@group.calendar.google.com"
      />
      <label>Vy:</label>
      <select id="calendarView">
        <option value="WEEK">Vecka</option>
        <option value="MONTH">Månad</option>
      </select>
      <button onclick="saveCalendarCfg()">Spara</button>

      <h2>System</h2>
      <button onclick="call('/api/system/reboot')">Reboot</button>
      <button onclick="call('/api/system/tv/on')">TV PÅ</button>
      <button onclick="call('/api/system/tv/off')">TV AV</button>
    </div>

    <script>
      async function loadCfg() {
        const c = await (await fetch('/api/config')).json();
        document.getElementById('min').value = c.minImageLongSide;
        if (c.calendar) {
          document.getElementById('calendarId').value =
            c.calendar.calendarId || '';
          document.getElementById('calendarView').value =
            c.calendar.view || 'WEEK';
        }
      }
      async function saveCfg() {
        await fetch('/api/config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ minImageLongSide: +min.value }),
        });
      }
      async function saveCalendarCfg() {
        await fetch('/api/config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            calendar: {
              calendarId: document.getElementById('calendarId').value,
              view: document.getElementById('calendarView').value,
            },
          }),
        });
      }
      async function call(url) {
        try {
          const response = await fetch(url, { method: 'POST' });
          const data = await response.json();
          if (data.ok) {
            alert('Kommando utfört!');
          } else {
            alert('Fel: ' + (data.error || 'Okänt fel'));
          }
        } catch (error) {
          alert('Fel vid anrop: ' + error.message);
        }
      }
      async function logout() {
        await fetch('/logout', { method: 'POST' });
        window.location.href = '/';
      }
      loadCfg();
    </script>
  </body>
</html>
